---
### Bundle

name    : cloudsc-bundle
version : 1.0.0-develop
cmake : >
        CMAKE_LINK_DEPENDS_NO_SHARED=ON

projects :

    - ecbuild :
        git     : https://github.com/ecmwf/ecbuild 
        version : 3.7.0
        bundle  : false

    - serialbox :
        git     : https://github.com/reuterbal/serialbox
        version : v2.5.4/patched
        optional: true
        cmake   : >
            BUILD_serialbox=OFF
            SERIALBOX_BUILD_SHARED=ON
            SERIALBOX_ENABLE_FORTRAN=ON
            SERIALBOX_ENABLE_EXPERIMENTAL_FILESYSTEM=OFF
            SERIALBOX_ENABLE_SDB=OFF
            SERIALBOX_EXAMPLES=OFF
            Serialbox_TARGETS_EXPORTED=TRUE
            CMAKE_CXX_EXTENSIONS=ON

    - loki :
        git     : https://github.com/ecmwf-ifs/loki
        version : main
        optional: true
        require : ecbuild
        cmake   : >
            LOKI_ENABLE_TESTS=OFF
            LOKI_ENABLE_NO_INSTALL=ON

    - field_api :
        git     : ${BITBUCKET}/rdx/field_api
        version : master
        optional: true
        require : ecbuild
        cmake   : >
            BUILD_field_api=OFF
            ENABLE_FIELD_API_TESTS=OFF
            ENABLE_FIELD_API_FIAT_BUILD=OFF
            FIELD_API_UTIL_MODULE_PATH=${CMAKE_SOURCE_DIR}/cloudsc-dwarf/src/common/module

    - cloudsc-dwarf :
        # The CLOUDSC dwarf project with multiple implementations
        dir     : $PWD
        version : develop
        require : ecbuild serialbox loki field_api

options :

    - toolchain :
        help  : Specify compiler options via supplied toolchain file
        cmake : CMAKE_TOOLCHAIN_FILE={{value}}

    - single-precision :
        help  : Enable single precision build of the dwarf
        cmake : ENABLE_SINGLE_PRECISION=ON

    - with-gpu :
        help  : Enable GPU kernels
        cmake : >
            ENABLE_CLOUDSC_GPU_SCC=ON
            ENABLE_CLOUDSC_GPU_SCC_HOIST=ON
            ENABLE_CLOUDSC_GPU_SCC_K_CACHING=ON
            ENABLE_CLOUDSC_GPU_OMP_SCC_HOIST=ON

    - with-cuda :
        help  : Enable GPU kernel variant based on CUDA-Fortran
        cmake : >
            ENABLE_CUDA=ON
            ENABLE_CLOUDSC_GPU_SCC_CUF=ON
            ENABLE_CLOUDSC_GPU_SCC_CUF_K_CACHING=ON
            BUILD_field_api=ON

    - with-mpi :
        help  : Enable MPI-parallel kernel
        cmake : ENABLE_MPI=ON

    - with-loki :
        help  : Enable Loki source-to-source transformations
        cmake : >
            ENABLE_CLOUDSC_LOKI=ON
            LOKI_ENABLE_NO_INSTALL=OFF

    - with-claw :
        help  : Enable deprecated (and defunct) CLAW-generated variants
        cmake : >
            ENABLE_CLOUDSC_GPU_CLAW=ON
            ENABLE_CLOUDSC_LOKI_CLAW=ON
            LOKI_ENABLE_CLAW=ON

    - without-loki-install :
        help  : Skip installation of Loki (Requires Loki to be on the PATH)
        cmake : >
            LOKI_ENABLE_NO_INSTALL=ON
            LOKI_ENABLE_CLAW=OFF

    - loki-frontend :
        help  : Frontend parser to use for Loki transformations
        cmake : LOKI_FRONTEND={{value}}

    - with-python :
        help  : Enable Python variants of CLOUDSC
        cmake : >
            CLOUDSC_PYTHON_F2PY=ON

    - cloudsc-prototype1 :
        help  : Build the original operational Fortran prototype [ON|OFF]
        cmake : ENABLE_CLOUDSC_PROTOTYPE1={{value}}

    - cloudsc-fortran :
        help  : Build the new Fortran version of CLOUDSC [ON|OFF]
        cmake : ENABLE_CLOUDSC_FORTRAN={{value}}

    - cloudsc-fortran-pyiface :
        help  : Build the Python driver interfaced with the new Fortran version of CLOUDSC [ON|OFF]
        cmake : ENABLE_CLOUDSC_FORTRAN_PYIFACE={{value}}

    - cloudsc-fortran-pyiface-binary :
        help  : Build the Fortran binary for the PYIFACE version [ON|OFF]
        cmake : ENABLE_CLOUDSC_FORTRAN_PYIFACE_BINARY={{value}}

    - cloudsc-c :
        help  : Build the C version of CLOUDSC [ON|OFF]
        cmake : ENABLE_CLOUDSC_C={{value}}

    - cloudsc-cuda :
        help  : Build the CUDA C version of CLOUDSC [ON|OFF]
        cmake : ENABLE_CLOUDSC_CUDA={{value}}

    - cloudsc-gpu-claw :
        help  : Build the deprecated CLAW-based GPU version CLOUDSC  [ON|OFF]
        cmake : ENABLE_CLOUDSC_GPU_CLAW={{value}}

    - cloudsc-loki :
        help  : Build the optimized Loki-based GPU version CLOUDSC  [ON|OFF]
        cmake : ENABLE_CLOUDSC_LOKI={{value}}

    - cloudsc-loki-claw :
        help  : Build the deprecated Loki+CLAW-based GPU version CLOUDSC  [ON|OFF]
        cmake : ENABLE_CLOUDSC_LOKI_CLAW={{value}}

    - cloudsc-python-f2py :
        help  : Enable dedicated pure Python variant of CLOUDSC [ON|OFF]
        cmake : ENABLE_CLOUDSC_PYTHON_F2PY={{value}}

    - hdf5 :
        help : Enable use of HDF5 input file [ON|OFF]
        cmake : ENABLE_HDF5={{value}}

    - without-hdf5 :
        help : Disable use of HDF5 input file
        cmake : ENABLE_HDF5=OFF

    - with-serialbox :
        help  : Enable Serialbox utility for platform-agnostic file I/O (disables HDF5)
        cmake : >
            ENABLE_HDF5=OFF
            ENABLE_SERIALBOX=ON
            BUILD_serialbox=ON

    - serialbox-experimental :
        help  : Enable Serialbox experimental filesystem [ON|OFF]
        cmake : SERIALBOX_ENABLE_EXPERIMENTAL_FILESYSTEM={{value}}

...
